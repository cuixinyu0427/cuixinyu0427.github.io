class EasyDanmaku{constructor(e){this.container=this.checkParams(e),this.pathname=e.page||null,this.wrapperStyle=e.wrapperStyle||null,this.line=e.line||10,this.speed=e.speed||5,this.runtime=e.runtime||10,this.colourful=e.colourful||!1,this.loop=e.loop||!1,this.hover=e.hover||!1,this.coefficient=e.coefficient||1.38,this.originIndex=0,this.originList=null,this.offsetValue=window.innerHeight/this.line,this.vipIndex=0,this.overflowArr=[],this.clearIng=!1,this.cleartimer=null,this.init(),this.handleEvents(e)}handleEvents(e){this.onComplete=e.onComplete||null,this.onHover=e.onHover||null}init(){this.runstatus=1,this.aisle=[],this.container.style.overflow="hidden",this.hover&&this.handleMouseHover(),"relative"!==Utils.getStyle(this.container,"position")&&"fixed"!==Utils.getStyle(this.container,"position")&&(this.container.style.position="relative");for(let e=0;e<this.line;e++)this.aisle.push({normalRow:!0,vipRow:!0})}checkParams(e){if(!document.querySelector(e.el))throw`Could not find the ${e.el} element`;if(e.wrapperStyle&&"string"!=typeof e.wrapperStyle)throw"The type accepted by the wrapperStyle parameter is string";if(e.line&&"number"!=typeof e.line)throw"The type accepted by the line parameter is number";if(e.speed&&"number"!=typeof e.speed)throw"The type accepted by the speed parameter is number";if(e.colourful&&"boolean"!=typeof e.colourful)throw"The type accepted by the colourful parameter is boolean";if(e.runtime&&"number"!=typeof e.runtime)throw"The type accepted by the runtime parameter is number";if(e.loop&&"boolean"!=typeof e.loop)throw"The type accepted by the loop parameter is boolean";if(e.coefficient&&"number"!=typeof e.coefficient)throw"The type accepted by the coefficient parameter is number";if(e.hover&&"boolean"!=typeof e.hover)throw"The type accepted by the hover parameter is boolean";if(e.onComplete&&"function"!=typeof e.onComplete)throw"The type accepted by the onComplete parameter is function";if(e.onHover&&"function"!=typeof e.onHover)throw"The type accepted by the onHover parameter is function";return document.querySelector(e.el)}send(e,t=null,i=null){if(0==this.runstatus)return void this.overflowArr.push({content:e,normalClass:t});if(e.length<1)return;let n=document.createElement("div"),r=0,s=this.speed,o=null,l=0;n.innerHTML=e,n.style.display="inline-block",n.classList.add("default-style"),(t||this.wrapperStyle)&&n.classList.add(t||this.wrapperStyle),function a(){if(r=Math.round(Math.random()*(this.line-1)),this.aisle[r].normalRow){this.aisle[r].normalRow=!1,this.container.appendChild(n),s+=n.offsetWidth/n.parentNode.offsetWidth*2,n.style.cssText=`\n                    text-align:center;\n                    min-width:130px;\n                    will-change: transform;\n                    position:absolute;\n                    right: -${n.offsetWidth+130}px;\n                    transition: transform ${s}s linear;\n                    transform: translateX(-${n.parentNode.offsetWidth+n.offsetWidth+130}px);\n                    top: ${r*this.offsetValue}px;\n                    line-height:${this.offsetValue}px;\n                    color:${this.colourful?"#"+("00000"+(16777216*Math.random()|0).toString(16)).substr(-6):void 0}\n                `;let e=(n.parentNode.offsetWidth+n.offsetWidth)/s/60;o=setInterval((()=>{l+=e,l>n.offsetWidth*this.coefficient&&(this.aisle[r].normalRow=!0,clearInterval(o))}),16.66),setTimeout((()=>{1!=n.getAttribute("relieveDel")&&(i&&i({runtime:s,target:n,width:n.offsetWidth}),n.remove())}),1e3*s)}else this.aisle.some((e=>!0===e.normalRow))?a.call(this):(()=>{this.overflowArr.push({content:e,normalClass:t}),this.clearIng||this.clearOverflowDanmakuArray()})()}.call(this)}batchSend(e,t=!1,i=null){let n=this.runtime||1.23*e.length;this.originList=e,this.hasAvatar=t,this.normalClass=i;let r=setInterval((()=>{location.pathname!=this.pathname&&clearInterval(r),this.originIndex>e.length-1?(clearInterval(r),this.originIndex=0,this.onComplete&&this.onComplete(),this.loop&&this.batchSend(this.originList,t,i)):(t?this.send(`${e[this.originIndex].url?'<a href="'+e[this.originIndex].url+'">':""}<img src=${e[this.originIndex].avatar}>\n                        <p>${e[this.originIndex].content}</p>${e[this.originIndex].url?"</a>":""}\n                    `,i||this.wrapperStyle):this.send(e[this.originIndex],i||this.wrapperStyle),this.originIndex++)}),n/e.length*1e3)}centeredSend(e,t,i=3e3,n=null){let r=document.createElement("div"),s=0;r.innerHTML=e,(t||this.wrapperStyle)&&r.classList.add(t||this.wrapperStyle),function e(){if(this.aisle[s].vipRow)this.container.appendChild(r),r.style.cssText=`\n                    position:absolute;\n                    left:50%;\n                    transform:translateX(-50%);\n                    top: ${s*this.offsetValue}px;\n                `,this.aisle[s].vipRow=!1,setTimeout((()=>{n&&n({duration:i,target:r,width:r.offsetWidth}),r.remove(),this.aisle[s].vipRow=!0}),i);else{if(s++,s>this.line-1)return;e.call(this)}}.call(this)}play(){const e=this.container.children;for(let t=0;t<e.length;t++)this.controlDanmakurunStatus(e[t],1);this.runstatus=1,0!==this.overflowArr.length&&this.clearOverflowDanmakuArray()}pause(){const e=this.container.children;for(let t=0;t<e.length;t++)this.controlDanmakurunStatus(e[t],0);this.runstatus=0}controlDanmakurunStatus(e,t){const i=/-(\S*),/;if(1===t){clearTimeout(e.timer);const t=Utils.getStyle(e,"transform").match(i)[1];e.style.transition=`transform ${this.speed}s linear`,e.style.transform=`translateX(-${e.parentNode.offsetWidth+parseInt(t)+e.offsetWidth+130}px)`,e.timer=setTimeout((()=>{e.remove()}),1e3*this.speed)}else if(0===t){clearTimeout(e.timer);const t=Utils.getStyle(e,"transform").match(i)[1];e.style.transition="transform 0s linear",e.style.transform=`translateX(-${t}px)`,e.setAttribute("relieveDel",1)}}handleMouseHover(){Utils.eventDelegation(this.container,"default-style","mouseover",(e=>{e.style["z-index"]=1e3,this.controlDanmakurunStatus(e,0),this.onHover&&this.onHover(e)})),Utils.eventDelegation(this.container,"default-style","mouseout",(e=>{e.style.zIndex=1,1==this.runstatus&&this.controlDanmakurunStatus(e,1)}))}clearOverflowDanmakuArray(){clearInterval(this.cleartimer),this.clearIng=!0;let e=0;this.cleartimer=setInterval((()=>{0===this.overflowArr.length?(e++,e>20&&(clearInterval(this.cleartimer),this.clearIng=!1)):(this.send(this.overflowArr[0].content,this.overflowArr[0].normalClass||this.wrapperStyle),this.overflowArr.shift())}),500)}}class Utils{static getStyle(e,t){return window.getComputedStyle(e,null)[t]}static eventDelegation(e,t,i,n){e.addEventListener(i,(e=>{try{e.target.className.includes(t)?n(e.target):e.target.parentNode.className.includes(t)&&n(e.target.parentNode)}catch(e){}}))}}