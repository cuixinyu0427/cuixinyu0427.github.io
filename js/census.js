var dataUrl="https://baidu.tongji.cuixinyu.com",metrics="pv_count",metricsName="pv_count"===metrics?"访问次数":"visitor_count"===metrics?"访客数":"",color="light"===document.documentElement.getAttribute("data-theme")?"#4c4948":"rgba(255,255,255,0.7)";function mapChart(){let t=document.createElement("script");fetch(dataUrl+"/map.json?date"+new Date).then((t=>t.json())).then((e=>{let n=e.result.items[0],r=e.result.items[1],a=[],o=r[0][0];for(let t=0;t<n.length;t++)a.push({name:n[t][0].name,value:r[t][0]});let s=JSON.stringify(a);t.innerHTML=`\n      var mapChart = echarts.init(document.getElementById('map-chart'), 'light');\n      var mapOption = {\n        title: {\n          text: '博客访问来源地图',\n          x: 'center',\n          textStyle: {\n            color: '${color}'\n          }\n        },\n        tooltip: {\n          trigger: 'item'\n        },\n        visualMap: {\n          min: 0,\n          max: ${o},\n          left: 'left',\n          top: 'bottom',\n          text: ['高','低'],\n          color: ['#37a2da', '#92d0f9'],\n          textStyle: {\n            color: '${color}'\n          },\n          calculable: true\n        },\n        series: [{\n          name: '${metricsName}',\n          type: 'map',\n          mapType: 'china',\n          showLegendSymbol: false,\n          label: {\n            normal: {\n              show: false\n            },\n            emphasis: {\n              show: true,\n              color: '#617282'\n            }\n          },\n          itemStyle: {\n            normal: {\n              areaColor: 'rgb(230, 232, 234)',\n              borderColor: 'rgb(255, 255, 255)',\n              borderWidth: 1\n            },\n            emphasis: {\n              areaColor: 'gold'\n            }\n          },\n          data: ${s}\n        }]\n      };\n      mapChart.setOption(mapOption);\n      window.addEventListener("resize", () => { \n        mapChart.resize();\n      });`,document.getElementById("map-chart").after(t)})).catch((function(t){console.log(t)}))}function get_year(t){return parseInt(t.substr(0,4))}function get_month(t){return parseInt(t.substr(5,2))}function trendsChart(){let t=document.createElement("script");fetch(dataUrl+"/trends.json?date"+new Date).then((t=>t.json())).then((e=>{let n=new Date,r={},a=e.result.items[0],o=e.result.items[1];for(let t=2020;t<=n.getFullYear();t++)r[String(t)]=[,,,,,,,,,,,];for(let t=0;t<a.length;t++){let e=get_year(a[t][0]),n=get_month(a[t][0]);r[String(e)][String(n-1)]=o[t][0]}t.innerHTML=`\n        var trendsChart = echarts.init(document.getElementById('trends-chart'), 'light');\n        var trendsOption = {\n            title: { text: '访问趋势', x: 'center' },\n            tooltip: { trigger: 'axis' },\n            legend: { data: ['2020', '2021', '2022'], x: 'right' },\n            xAxis: {\n                name: '日期', type: 'category', boundaryGap: false,\n                data: ['一月', '二月', '三月', '四月', '五月', '六月', '七月', '八月', '九月', '十月', '十一月', '十二月']\n            },\n            yAxis: { name: '${metricsName}', type: 'value' },\n            series: [\n                {\n                    name: '2020', type: 'line', smooth: true,\n                    data: [${r[2020]}],\n                    markLine: { data: [{type: 'average', name: '平均值'}] }\n                },\n                {\n                    name: '2021', type: 'line', smooth: true,\n                    data: [${r[2021]}],\n                    markLine: { data: [{type: 'average', name: '平均值'}] }\n                },\n                {\n                    name: '2022', type: 'line', smooth: true,\n                    data: [${r[2022]}],\n                    markLine: { data: [{type: 'average', name: '平均值'}] }\n                }\n            ]\n        };\n        trendsChart.setOption(trendsOption);\n        window.addEventListener("resize", () => { \n            trendsChart.resize();\n        });`,document.getElementById("trends-chart").after(t)})).catch((function(t){console.log(t)}))}function sourcesChart(){let t=document.createElement("script");fetch(dataUrl+"/sources.json?date"+new Date).then((t=>t.json())).then((e=>{let n=e.result.items[0],r=e.result.items[1],a=[];for(let t=0;t<n.length;t++)a.push({name:n[t][0].name,value:r[t][0]});let o=JSON.stringify(a);t.innerHTML=`\n      var sourcesChart = echarts.init(document.getElementById('sources-chart'), 'light');\n      var sourcesOption = {\n        title: {\n          text: '博客访问来源统计图',\n          x: 'center',\n          textStyle: {\n            color: '${color}'\n          }\n        },\n        legend: {\n          top: 'bottom',\n          textStyle: {\n            color: '${color}'\n          }\n        },\n        tooltip: {\n          trigger: 'item'\n        },\n        series: [{\n          name: '${metricsName}',\n          type: 'pie',\n          radius: [30, 80],\n          center: ['50%', '50%'],\n          roseType: 'area',\n          label: {\n            color: '${color}',\n            formatter: "{b} : {c} ({d}%)"\n          },\n          data: ${o},\n          itemStyle: {\n            emphasis: {\n              shadowBlur: 10,\n              shadowOffsetX: 0,\n              shadowColor: 'rgba(255, 255, 255, 0.5)'\n            }\n          }\n        }]\n      };\n      sourcesChart.setOption(sourcesOption);\n      window.addEventListener("resize", () => { \n        sourcesChart.resize();\n      });`,document.getElementById("sources-chart").after(t)})).catch((function(t){console.log(t)}))}function switchVisitChart(){let t="light"===document.documentElement.getAttribute("data-theme")?"#4c4948":"rgba(255,255,255,0.7)";if(document.getElementById("map-chart")&&mapOption)try{let e=mapOption;e.title.textStyle.color=t,e.visualMap.textStyle.color=t,mapChart.setOption(e)}catch(t){console.log(t)}if(document.getElementById("trends-chart")&&trendsOption)try{let e=trendsOption;e.title.textStyle.color=t,e.xAxis.nameTextStyle.color=t,e.yAxis.nameTextStyle.color=t,e.xAxis.axisLabel.color=t,e.yAxis.axisLabel.color=t,e.xAxis.axisLine.lineStyle.color=t,e.yAxis.axisLine.lineStyle.color=t,e.series[0].markLine.data[0].label.color=t,trendsChart.setOption(e)}catch(t){console.log(t)}if(document.getElementById("sources-chart")&&sourcesOption)try{let e=sourcesOption;e.title.textStyle.color=t,e.legend.textStyle.color=t,e.series[0].label.color=t,sourcesChart.setOption(e)}catch(t){console.log(t)}}document.getElementById("map-chart")&&mapChart(),document.getElementById("trends-chart")&&trendsChart(),document.getElementById("sources-chart")&&sourcesChart(),document.getElementById("darkmode").addEventListener("click",(function(){setTimeout(switchVisitChart,100)}));